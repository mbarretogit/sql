USE LYCEUMA
GO

--CRIA TABELA COM GRUPOS DE DISCIPLINAS QUE TERÃO PROVAS E FÓRMULAS ALTERADAS
SELECT DISTINCT 'NEOCNHUPAC' AS GRUPO, DISCIPLINA
INTO TEMP_GRUPO_DISC 
FROM LY_DISCIPLINA
WHERE DISCIPLINA IN ('143015',
'143016',
'143017',
'143018',
'143019',
'143024',
'143025',
'143026',
'143028',
'143029',
'143030',
'143031',
'143032',
'143033',
'143034',
'143039',
'143040',
'143041',
'143044',
'143045',
'143046',
'143047',
'143048',
'143049',
'143050',
'143054',
'143055',
'143056',
'143057',
'143058',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143077',
'143078',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143093',
'143094',
'143095',
'143096',
'143097',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143114',
'143115',
'143116',
'143117',
'143118',
'143512',
'143514',
'143515',
'143516',
'143517',
'143525',
'143526',
'143527',
'143529',
'144631',
'144664',
'144666',
'144667',
'144668',
'144669',
'144670',
'144672',
'144673',
'144674',
'144675',
'145510',
'143026',
'143025',
'143024',
'143019',
'143018',
'143017',
'143016',
'143015',
'143031',
'143030',
'143029',
'143028',
'143039',
'143034',
'143033',
'143032',
'143041',
'143040',
'143045',
'143044',
'143049',
'143048',
'143047',
'143046',
'143057',
'143056',
'143055',
'143054',
'143050',
'143058',
'143060',
'143063',
'143062',
'143066',
'143065',
'143064',
'143076',
'143075',
'143078',
'143077',
'143080',
'143079',
'143084',
'143083',
'143082',
'143081',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143118',
'143117',
'143116',
'143115',
'143114',
'143514',
'143512',
'143526',
'143525',
'143517',
'143516',
'143515',
'144631',
'143529',
'143527',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143050',
'143054',
'143055',
'143056',
'143057',
'143046',
'143047',
'143048',
'143049',
'143044',
'143045',
'143058',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143061',
'143077',
'143078',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143085',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143100',
'143118',
'143114',
'143115',
'143116',
'143117',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144631',
'143527',
'143529',
'144664',
'144666',
'144667',
'144668',
'145510',
'144674',
'144675',
'144669',
'144670',
'144672',
'144673',
'143100',
'143118',
'143117',
'143116',
'143115',
'143114',
'143113',
'143112',
'143103',
'143102',
'143101',
'143099',
'143104',
'144631',
'143529',
'143527',
'143514',
'143512',
'143517',
'143516',
'143515',
'143526',
'143525',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143085',
'143084',
'143083',
'143082',
'143081',
'143080',
'143079',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143100',
'143118',
'143114',
'143115',
'143116',
'143117',
'143104',
'144631',
'143527',
'143529',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144664',
'144666',
'144667',
'144668',
'145510',
'144674',
'144675',
'144669',
'144670',
'144672',
'144673',
'143061',
'143078',
'143077',
'143076',
'143075',
'143066',
'143064',
'143063',
'143062',
'143060',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143085',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143100',
'143118',
'143117',
'143116',
'143115',
'143114',
'143104',
'144631',
'143529',
'143527',
'143514',
'143512',
'143517',
'143516',
'143515',
'143526',
'143525',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143027',
'143015',
'143016',
'143017',
'143018',
'143019',
'143024',
'143025',
'143026',
'143028',
'143029',
'143030',
'143031',
'143032',
'143033',
'143034',
'143039',
'143040',
'143041',
'143042',
'143058',
'143045',
'143044',
'143049',
'143048',
'143047',
'143046',
'143057',
'143056',
'143055',
'143054',
'143050',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143077',
'143078',
'143080',
'143079',
'143084',
'143083',
'143082',
'143081',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143100',
'143118',
'143114',
'143115',
'143116',
'143117',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144631',
'143527',
'143529',
'144664',
'144666',
'144667',
'144668',
'145510',
'144674',
'144675',
'144669',
'144670',
'144672',
'144673',
'143019',
'143018',
'143017',
'143016',
'143015',
'143026',
'143025',
'143024',
'143031',
'143030',
'143029',
'143028',
'143039',
'143034',
'143033',
'143032',
'143041',
'143040',
'143044',
'143045',
'143046',
'143047',
'143048',
'143049',
'143050',
'143054',
'143055',
'143056',
'143057',
'143058',
'143060',
'143063',
'143062',
'143066',
'143065',
'143064',
'143076',
'143075',
'143078',
'143077',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143118',
'143117',
'143116',
'143115',
'143114',
'143514',
'143512',
'143526',
'143525',
'143516',
'143515',
'143517',
'144631',
'143529',
'143527',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143024',
'143025',
'143026',
'143015',
'143016',
'143017',
'143018',
'143019',
'143028',
'143029',
'143030',
'143031',
'143032',
'143033',
'143034',
'143039',
'143040',
'143041',
'143045',
'143044',
'143049',
'143048',
'143047',
'143046',
'143057',
'143056',
'143055',
'143054',
'143050',
'143058',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143077',
'143078',
'143080',
'143079',
'143084',
'143083',
'143082',
'143081',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143118',
'143114',
'143115',
'143116',
'143117',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144631',
'143527',
'143529',
'144664',
'144666',
'144667',
'144668',
'144669',
'144670',
'144672',
'144673',
'144674',
'144675',
'145510',
'143026',
'143025',
'143024',
'143019',
'143018',
'143017',
'143016',
'143015',
'143031',
'143030',
'143029',
'143028',
'143039',
'143034',
'143033',
'143032',
'143041',
'143040',
'143044',
'143045',
'143046',
'143047',
'143048',
'143049',
'143050',
'143054',
'143055',
'143056',
'143057',
'143058',
'143060',
'143063',
'143062',
'143066',
'143065',
'143064',
'143076',
'143075',
'143078',
'143077',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143118',
'143117',
'143116',
'143115',
'143114',
'143514',
'143512',
'143526',
'143525',
'143516',
'143515',
'143517',
'144631',
'143529',
'143527',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143024',
'143025',
'143026',
'143015',
'143016',
'143017',
'143018',
'143019',
'143028',
'143029',
'143030',
'143031',
'143032',
'143033',
'143034',
'143039',
'143040',
'143041',
'143045',
'143044',
'143049',
'143048',
'143047',
'143046',
'143057',
'143056',
'143055',
'143054',
'143050',
'143058',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143077',
'143078',
'143080',
'143079',
'143084',
'143083',
'143082',
'143081',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143118',
'143114',
'143115',
'143116',
'143117',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144631',
'143527',
'143529',
'144664',
'144666',
'144667',
'144668',
'144669',
'144670',
'144672',
'144673',
'144674',
'144675',
'145510',
'143026',
'143025',
'143024',
'143019',
'143018',
'143017',
'143016',
'143015',
'143031',
'143030',
'143029',
'143028',
'143039',
'143034',
'143033',
'143032',
'143041',
'143040',
'143044',
'143045',
'143046',
'143047',
'143048',
'143049',
'143050',
'143054',
'143055',
'143056',
'143057',
'143058',
'143060',
'143063',
'143062',
'143066',
'143065',
'143064',
'143076',
'143075',
'143078',
'143077',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143118',
'143117',
'143116',
'143115',
'143114',
'143514',
'143512',
'143526',
'143525',
'143516',
'143515',
'143517',
'144631',
'143529',
'143527',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669',
'143024',
'143025',
'143026',
'143015',
'143016',
'143017',
'143018',
'143019',
'143028',
'143029',
'143030',
'143031',
'143032',
'143033',
'143034',
'143039',
'143040',
'143041',
'143045',
'143044',
'143049',
'143048',
'143047',
'143046',
'143057',
'143056',
'143055',
'143054',
'143050',
'143058',
'143060',
'143062',
'143063',
'143064',
'143065',
'143066',
'143075',
'143076',
'143077',
'143078',
'143080',
'143079',
'143084',
'143083',
'143082',
'143081',
'143097',
'143096',
'143095',
'143094',
'143093',
'143099',
'143101',
'143102',
'143103',
'143112',
'143113',
'143118',
'143114',
'143115',
'143116',
'143117',
'143512',
'143514',
'143517',
'143515',
'143516',
'143525',
'143526',
'144631',
'143527',
'143529',
'144664',
'144666',
'144667',
'144668',
'144669',
'144670',
'144672',
'144673',
'144674',
'144675',
'145510',
'143026',
'143025',
'143024',
'143019',
'143018',
'143017',
'143016',
'143015',
'143031',
'143030',
'143029',
'143028',
'143039',
'143034',
'143033',
'143032',
'143041',
'143040',
'143044',
'143045',
'143046',
'143047',
'143048',
'143049',
'143050',
'143054',
'143055',
'143056',
'143057',
'143058',
'143060',
'143063',
'143062',
'143066',
'143065',
'143064',
'143076',
'143075',
'143078',
'143077',
'143079',
'143080',
'143081',
'143082',
'143083',
'143084',
'143097',
'143093',
'143094',
'143095',
'143096',
'143099',
'143102',
'143101',
'143113',
'143112',
'143103',
'143118',
'143117',
'143116',
'143115',
'143114',
'143514',
'143512',
'143526',
'143525',
'143516',
'143515',
'143517',
'144631',
'143529',
'143527',
'144664',
'144668',
'144667',
'144666',
'145510',
'144675',
'144674',
'144673',
'144672',
'144670',
'144669')
UNION
SELECT DISTINCT 'NASINTERNATO' AS GRUPO, DISCIPLINA
FROM LY_DISCIPLINA
WHERE DISCIPLINA IN ('')
GO

--APAGA NOTAS DAS DISCIPLINAS QUE SOFRERÃO AJUSTE
DELETE FROM LY_NOTA
WHERE DISCIPLINA IN (SELECT DISCIPLINA FROM TEMP_GRUPO_DISC)
AND ANO = 2017 AND SEMESTRE = 2
GO

--APAGA PROVAS DAS TURMAS E DAS DISCIPLINAS QUE SOFRERÃO AJUSTE
DELETE FROM LY_PROVA
WHERE DISCIPLINA IN (SELECT DISCIPLINA FROM TEMP_GRUPO_DISC)
AND ANO = 2017 AND SEMESTRE = 2
GO

DELETE FROM LY_PROVA_DISCIP
WHERE DISCIPLINA IN (SELECT DISCIPLINA FROM TEMP_GRUPO_DISC)
GO

--INSERE NOVAS PROVAS DE ACORDO COM O GRUPO NEOC e NHUPAC
--V1 - 30 PONTOS --V2 - 70 PONTOS -- V3 - 100 PONTOS
INSERT INTO LY_PROVA_DISCIP
SELECT DISCIPLINA,'V1','Verificação 1', 'S',NULL,'S',NULL,1,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NEOCNHUPAC'
UNION
SELECT DISCIPLINA,'V2','Verificação 2', 'S',NULL,'S',NULL,2,NULL,'N',70,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NEOCNHUPAC'
UNION
SELECT DISCIPLINA,'V3','Verificação 3', 'S',NULL,'S',NULL,3,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NEOCNHUPAC'
UNION
SELECT DISCIPLINA,'VF','Verificação Final', 'S',NULL,'S',NULL,4,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NEOCNHUPAC'
GO

INSERT INTO LY_PROVA
SELECT T.DISCIPLINA, T.TURMA,2017,1,'V1','Verificação 1',NULL,NULL,NULL,NULL,'S',NULL,1,NULL,'S',NULL,NULL,NULL,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NEOCNHUPAC' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'V2','Verificação 2',NULL,NULL,NULL,NULL,'S',NULL,2,NULL,'S',NULL,NULL,NULL,NULL,'N',70,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NEOCNHUPAC' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'V3','Verificação 3',NULL,NULL,NULL,NULL,'S',NULL,3,NULL,'S',NULL,NULL,NULL,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NEOCNHUPAC' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'VF','Verificação Final',NULL,NULL,NULL,NULL,'S',NULL,4,NULL,'S',NULL,NULL,NULL,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NEOCNHUPAC' AND T.ANO = 2017 AND T.SEMESTRE = 2
GO

--INSERE NOVAS PROVAS DE ACORDO COM O GRUPO NAS e INTERNATO
--DP - 30 PONTOS --AT - 30 PONTOS -- AV - 40 PONTOS
INSERT INTO LY_PROVA_DISCIP
SELECT DISCIPLINA,'DP','', 'S',NULL,'S',NULL,1,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NASINTERNATO'
UNION
SELECT DISCIPLINA,'AT','', 'S',NULL,'S',NULL,2,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NASINTERNATO'
UNION
SELECT DISCIPLINA,'AV','', 'S',NULL,'S',NULL,3,NULL,'N',40,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NASINTERNATO'
UNION
SELECT DISCIPLINA,'VF','Verificação Final', 'S',NULL,'S',NULL,4,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,'N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC WHERE GRUPO = 'NASINTERNATO'
GO

INSERT INTO LY_PROVA
SELECT T.DISCIPLINA, T.TURMA,2017,1,'DP','',NULL,NULL,NULL,NULL,'S',NULL,1,NULL,'S',NULL,NULL,NULL,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NASINTERNATO' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'AT','',NULL,NULL,NULL,NULL,'S',NULL,2,NULL,'S',NULL,NULL,NULL,NULL,'N',30,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NASINTERNATO' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'AV','',NULL,NULL,NULL,NULL,'S',NULL,3,NULL,'S',NULL,NULL,NULL,NULL,'N',40,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NASINTERNATO' AND T.ANO = 2017 AND T.SEMESTRE = 2
UNION
SELECT T.DISCIPLINA, T.TURMA,2017,1,'VF','Verificação Final',NULL,NULL,NULL,NULL,'S',NULL,4,NULL,'S',NULL,NULL,NULL,NULL,'N',100,'N','N',NULL,'N',NULL,NULL,NULL,'N','N',NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL,NULL
FROM TEMP_GRUPO_DISC TGD JOIN LY_TURMA T ON TGD.DISCIPLINA = T.DISCIPLINA 
WHERE GRUPO = 'NASINTERNATO' AND T.ANO = 2017 AND T.SEMESTRE = 2
GO

--ATUALIZA AS FÓRMULAS DAS TURMAS E DAS DISCIPLINAS QUE SOFRERÃO AJUSTE
--SELECT * 
UPDATE T SET T.FORMULA_MF1 = 'MAX((V1+V2),V3)', T.FORMULA_MF2 = '(MAX((V1+V2),V3)*0,4)+(VF*0,6)', T.FORMULA_CA1 = 'MAX((V1+V2),V3)', T.FORMULA_CA2 = '(MAX((V1+V2),V3)*0,4)+(VF*0,6)' 
FROM LY_TURMA T
JOIN TEMP_GRUPO_DISC TGD ON TGD.DISCIPLINA = T.DISCIPLINA
WHERE TGD.GRUPO = 'NEOCNHUPAC' AND T.ANO = 2017 AND T.SEMESTRE = 2
GO

--SELECT * 
UPDATE T SET T.FORMULA_MF1 = '(DP+AT+AV)', T.FORMULA_MF2 = '((DP+AT+AV)*0,4)+(VF*0,6)', T.FORMULA_CA1 = '(DP+AT+AV)', T.FORMULA_CA2 = '((DP+AT+AV)*0,4)+(VF*0,6)' 
FROM LY_TURMA T
JOIN TEMP_GRUPO_DISC TGD ON TGD.DISCIPLINA = T.DISCIPLINA
WHERE TGD.GRUPO = 'NASINTERNATO' AND T.ANO = 2017 AND T.SEMESTRE = 2
GO

DROP TABLE TEMP_GRUPO_DISC
GO